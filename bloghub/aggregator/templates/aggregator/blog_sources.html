{% extends 'aggregator/base.html' %}

{% block title %}Blog Ngu·ªìn - BlogHub{% endblock %}

{% block content %}
<!-- Header -->
<div class="bg-white border border-gray-300 p-6 mb-6">
    <div class="flex justify-between items-center mb-4">
        <h1 class="text-2xl font-bold text-gray-900">üìñ Blog Ngu·ªìn</h1>
        <a href="{% url 'aggregator:index' %}" class="text-blue-600 text-sm hover:text-blue-700">‚Üê V·ªÅ trang ch·ªß</a>
    </div>
    
    <!-- Search -->
    <div class="max-w-md">
        <form method="GET" class="flex gap-2">
            <input 
                type="text" 
                name="search"
                value="{{ search_query }}"
                placeholder="T√¨m ki·∫øm blog..."
                class="flex-1 px-3 py-2 border border-gray-400 focus:border-blue-600 focus:outline-none text-sm"
            >
            <button type="submit" class="px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 text-sm">
                T√¨m
            </button>
            {% if search_query %}
            <a href="{% url 'aggregator:blog_sources' %}" class="px-4 py-2 border border-gray-400 text-gray-700 hover:bg-gray-100 text-sm">
                X√≥a
            </a>
            {% endif %}
        </form>
    </div>
</div>

<!-- Alphabet Navigation -->
<div class="bg-white border border-gray-300 p-4 mb-6">
    <div class="flex flex-wrap gap-2">
        <a href="{% url 'aggregator:blog_sources' %}" 
           class="px-3 py-1 text-sm {% if not current_letter %}bg-blue-600 text-white{% else %}border border-gray-300 text-gray-700 hover:bg-gray-100{% endif %}">
            T·∫•t c·∫£
        </a>
        {% for letter in available_letters %}
        <a href="{% url 'aggregator:blog_sources' %}?letter={{ letter }}" 
           class="px-3 py-1 text-sm {% if current_letter == letter %}bg-blue-600 text-white{% else %}border border-gray-300 text-gray-700 hover:bg-gray-100{% endif %}">
            {{ letter }}
        </a>
        {% endfor %}
    </div>
</div>

<!-- Blog Sources Dictionary Style -->
<div class="bg-white border border-gray-300">
    {% for letter, sources in grouped_sources.items %}
    <div class="border-b border-gray-200 last:border-b-0">
        <!-- Letter Header -->
        <div class="bg-gray-50 px-6 py-3 border-b border-gray-200">
            <h2 class="text-xl font-bold text-gray-900">{{ letter }}</h2>
        </div>
        
        <!-- Sources List -->
        <div class="p-6">
            <div class="space-y-4">
                {% for source in sources %}
                <article class="flex items-start gap-4 p-4 border-l-2 border-blue-600 hover:bg-gray-50">
                    <!-- Logo -->
                    <div class="flex-shrink-0">
                        {% if source.logo_url %}
                        <img src="{{ source.logo_url }}" alt="{{ source.name }}" class="w-12 h-12 bg-gray-200">
                        {% else %}
                        <div class="w-12 h-12 bg-blue-600 flex items-center justify-center">
                            <span class="text-white font-bold text-lg">{{ source.name|first|upper }}</span>
                        </div>
                        {% endif %}
                    </div>
                    
                    <!-- Content -->
                    <div class="flex-1 min-w-0">
                        <!-- Name & Links -->
                        <div class="flex items-center gap-3 mb-2">
                            <h3 class="text-lg font-semibold text-gray-900">{{ source.name }}</h3>
                            {% if source.homepage_url %}
                            <a href="{{ source.homepage_url }}" target="_blank" class="text-blue-600 hover:text-blue-700 text-sm">
                                üåê Website
                            </a>
                            {% endif %}
                            <a href="{{ source.rss_url }}" target="_blank" class="text-orange-600 hover:text-orange-700 text-sm">
                                üì° RSS
                            </a>
                        </div>
                        
                        <!-- Author & Language -->
                        <div class="flex items-center gap-4 mb-2 text-sm text-gray-600">
                            {% if source.author %}
                            <span>‚úçÔ∏è {{ source.author }}</span>
                            {% endif %}
                            <span>üåê {{ source.get_language_display|default:"Vietnamese" }}</span>
                            <span>üìù {{ source.posts_count }} b√†i vi·∫øt</span>
                            {% if source.last_fetched %}
                            <span>‚è∞ C·∫≠p nh·∫≠t {{ source.last_fetched|date:"d/m H:i" }}</span>
                            {% endif %}
                        </div>
                        
                        <!-- Description -->
                        {% if source.description %}
                        <p class="text-gray-700 text-sm mb-3 line-clamp-3">{{ source.description }}</p>
                        {% endif %}
                        
                        <!-- Tags -->
                        {% if source.tag_list %}
                        <div class="flex flex-wrap gap-1">
                            {% for tag in source.tag_list %}
                            <span class="px-2 py-1 bg-gray-200 text-gray-700 text-xs">{{ tag }}</span>
                            {% endfor %}
                        </div>
                        {% endif %}
                        
                        <!-- Actions -->
                        <div class="mt-3 flex items-center gap-3">
                            <a href="{% url 'aggregator:all_posts' %}?blog_source={{ source.id }}" 
                               class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                                Xem b√†i vi·∫øt ‚Üí
                            </a>
                            {% if source.homepage_url %}
                            <a href="{{ source.homepage_url }}" target="_blank" 
                               class="text-gray-600 hover:text-gray-700 text-sm">
                                ThƒÉm blog ‚Üí
                            </a>
                            {% endif %}
                        </div>
                    </div>
                    
                    <!-- Stats -->
                    <div class="flex-shrink-0 text-right">
                        <div class="text-2xl font-bold text-blue-600">{{ source.posts_count }}</div>
                        <div class="text-xs text-gray-500">b√†i vi·∫øt</div>
                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
    </div>
    {% empty %}
    <!-- Empty State -->
    <div class="p-12 text-center">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.746 0 3.332.477 4.5 1.253v13C19.832 18.477 18.246 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"/>
        </svg>
        <h3 class="text-lg font-medium text-gray-900 mb-2">Kh√¥ng t√¨m th·∫•y blog n√†o</h3>
        <p class="text-gray-500 mb-4">
            {% if search_query %}
                Kh√¥ng c√≥ blog n√†o ph√π h·ª£p v·ªõi t·ª´ kh√≥a "{{ search_query }}"
            {% elif current_letter %}
                Kh√¥ng c√≥ blog n√†o b·∫Øt ƒë·∫ßu b·∫±ng ch·ªØ "{{ current_letter }}"
            {% else %}
                Ch∆∞a c√≥ blog ngu·ªìn n√†o ƒë∆∞·ª£c th√™m v√†o h·ªá th·ªëng
            {% endif %}
        </p>
        <a href="/admin/aggregator/blogsource/add/" 
           class="inline-flex items-center px-4 py-2 bg-blue-600 text-white hover:bg-blue-700 text-sm">
            Th√™m blog ngu·ªìn m·ªõi
        </a>
    </div>
    {% endfor %}
</div>

<!-- Quick Stats -->
<div class="mt-6 bg-white border border-gray-300 p-6">
    <h3 class="text-lg font-bold text-gray-900 mb-4">üìä Th·ªëng k√™</h3>
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="text-center">
            <div class="text-2xl font-bold text-blue-600">{{ grouped_sources|length }}</div>
            <div class="text-sm text-gray-500">Ch·ªØ c√°i c√≥ blog</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-green-600">
                {% for sources in grouped_sources.values %}{{ sources|length }}{% if not forloop.last %} + {% endif %}{% endfor %}
            </div>
            <div class="text-sm text-gray-500">T·ªïng blog</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-purple-600">
                {% for sources in grouped_sources.values %}
                    {% for source in sources %}{{ source.posts_count }}{% if not forloop.parentloop.last or not forloop.last %} + {% endif %}{% endfor %}
                {% endfor %}
            </div>
            <div class="text-sm text-gray-500">T·ªïng b√†i vi·∫øt</div>
        </div>
        <div class="text-center">
            <div class="text-2xl font-bold text-orange-600">VI</div>
            <div class="text-sm text-gray-500">Ng√¥n ng·ªØ ch√≠nh</div>
        </div>
    </div>
</div>

<style>
.line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}
</style>
{% endblock %}