{% extends 'aggregator/base.html' %}

{% block title %}BlogHub - T·ªïng h·ª£p Blog C√° nh√¢n{% endblock %}

{% block content %}
<!-- Hero Section -->
<div class="bg-blue-600 p-8 text-white mb-8">
    <h1 class="text-3xl font-bold mb-2">Ch√†o m·ª´ng ƒë·∫øn v·ªõi BlogHub! üëã</h1>
    <p class="text-blue-100 text-lg">T·ªïng h·ª£p v√† kh√°m ph√° n·ªôi dung t·ª´ c√°c blog c√° nh√¢n h√†ng ƒë·∫ßu</p>
</div>

<!-- Filters Section -->
<div class="bg-white border border-gray-300 p-6 mb-8">
    <div class="flex flex-col md:flex-row gap-4">
        <!-- Search -->
        <div class="flex-1">
            <label for="search" class="block text-sm font-medium text-gray-700 mb-2">T√¨m ki·∫øm</label>
            <input 
                type="text" 
                id="search" 
                name="search"
                value="{{ search_query }}"
                placeholder="T√¨m ki·∫øm theo ti√™u ƒë·ªÅ ho·∫∑c n·ªôi dung..."
                class="w-full px-4 py-2 border border-gray-400 focus:border-blue-600 focus:outline-none"
                hx-get="{% url 'aggregator:load_more_posts' %}"
                hx-trigger="keyup changed delay:500ms"
                hx-target="#posts-container"
                hx-include="[name='blog_source']"
                hx-indicator="#loading-indicator"
            >
        </div>
        
        <!-- Blog Source Filter -->
        <div class="md:w-64">
            <label for="blog_source" class="block text-sm font-medium text-gray-700 mb-2">L·ªçc theo blog</label>
            <select 
                name="blog_source" 
                id="blog_source"
                class="w-full px-4 py-2 border border-gray-400 focus:border-blue-600 focus:outline-none"
                hx-get="{% url 'aggregator:load_more_posts' %}"
                hx-trigger="change"
                hx-target="#posts-container"
                hx-include="[name='search']"
                hx-indicator="#loading-indicator"
            >
                <option value="">T·∫•t c·∫£ blog</option>
                {% for source in blog_sources %}
                    <option value="{{ source.id }}" {% if source.id|stringformat:"s" == current_blog_source %}selected{% endif %}>
                        {{ source.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
    </div>
</div>

<!-- Posts Container -->
<div id="posts-container">
    {% include 'aggregator/partials/post_list.html' %}
</div>

{% endblock %}

{% block extra_js %}
<script>
// Handle form submissions for filters
document.addEventListener('htmx:configRequest', function(evt) {
    // Include current filter values
    const search = document.getElementById('search').value;
    const blogSource = document.getElementById('blog_source').value;
    
    if (search) {
        evt.detail.parameters['search'] = search;
    }
    if (blogSource) {
        evt.detail.parameters['blog_source'] = blogSource;
    }
    
    // Always reset to page 1 for filters
    evt.detail.parameters['page'] = 1;
});
</script>
{% endblock %}